<!DOCTYPE html>
<html>
<head>
    <title>Employee Attendance App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        select, input, button {
            padding: 6px;
            margin-right: 8px;
        }
        button {
            cursor: pointer;
        }
        .summary {
            margin-top: 30px;
        }
    </style>
</head>

<body>

<h2>Employee Attendance App</h2>

<!-- Attendance Form -->
<label>Date:</label>
<input type="date" id="date">

<label>Employee:</label>
<select id="employeeName">
    <option>Alice</option>
    <option>Bob</option>
    <option>Charlie</option>
    <option>David</option>
</select>

<label>Project:</label>
<input type="text" id="projectName" placeholder="Project Name">

<label>Status:</label>
<select id="status">
    <option>Present</option>
    <option>Absent</option>
</select>

<button onclick="addAttendance()">Add</button>

<!-- Attendance Table -->
<table id="attendanceTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Employee</th>
            <th>Project</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Monthly Summary -->
<div class="summary">
    <h3>Monthly Summary</h3>

    <label>Select Month:</label>
    <input type="month" id="monthFilter" onchange="updateSummary()">

    <button onclick="exportExcel()">Export Excel</button>
    <button onclick="exportPDF()">Export PDF</button>

    <table id="summaryTable">
        <thead>
            <tr>
                <th>Employee</th>
                <th>Present</th>
                <th>Absent</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <th>Total</th>
                <th id="totalPresent">0</th>
                <th id="totalAbsent">0</th>
            </tr>
        </tfoot>
    </table>
</div>

<!-- JavaScript -->
<script>
    // Set today's date
    document.getElementById('date').valueAsDate = new Date();

    // Load saved data
    let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];

    function saveData() {
        localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
    }

    function addAttendance() {
        const date = document.getElementById('date').value;
        const employee = document.getElementById('employeeName').value;
        const project = document.getElementById('projectName').value;
        const status = document.getElementById('status').value;

        if (!project) {
            alert("Please enter project name");
            return;
        }

        // Prevent duplicate entry
        const duplicate = attendanceData.some(
            r => r.date === date && r.employee === employee
        );

        if (duplicate) {
            alert("Attendance already marked for this employee on this date.");
            return;
        }

        attendanceData.push({ date, employee, project, status });
        saveData();
        updateTable();
        updateSummary();

        document.getElementById('projectName').value = '';
    }

    function updateTable() {
        const tbody = document.querySelector("#attendanceTable tbody");
        tbody.innerHTML = '';

        attendanceData.forEach((r, index) => {
            const row = tbody.insertRow();
            row.insertCell(0).innerText = r.date;
            row.insertCell(1).innerText = r.employee;
            row.insertCell(2).innerText = r.project;
            row.insertCell(3).innerText = r.status;

            const actionCell = row.insertCell(4);
            const btn = document.createElement("button");
            btn.innerText = "Delete";
            btn.onclick = () => deleteAttendance(index);
            actionCell.appendChild(btn);
        });
    }

    function deleteAttendance(index) {
        if (!confirm("Are you sure you want to delete this record?")) return;
        attendanceData.splice(index, 1);
        saveData();
        updateTable();
        updateSummary();
    }

    function updateSummary() {
        const selectedMonth = document.getElementById('monthFilter').value;
        if (!selectedMonth) return;

        const summary = {};
        let totalPresent = 0;
        let totalAbsent = 0;

        attendanceData.forEach(r => {
            if (r.date.startsWith(selectedMonth)) {
                if (!summary[r.employee]) {
                    summary[r.employee] = { Present: 0, Absent: 0 };
                }
                summary[r.employee][r.status]++;
                r.status === "Present" ? totalPresent++ : totalAbsent++;
            }
        });

        const tbody = document.querySelector("#summaryTable tbody");
        tbody.innerHTML = '';

        for (let emp in summary) {
            const row = tbody.insertRow();
            row.insertCell(0).innerText = emp;
            row.insertCell(1).innerText = summary[emp].Present;
            row.insertCell(2).innerText = summary[emp].Absent;
        }

        document.getElementById("totalPresent").innerText = totalPresent;
        document.getElementById("totalAbsent").innerText = totalAbsent;
    }

    function exportExcel() {
        const month = document.getElementById('monthFilter').value;
        if (!month) return alert("Select a month");

        let csv = "Date,Employee,Project,Status\n";
        attendanceData
            .filter(r => r.date.startsWith(month))
            .forEach(r => {
                csv += `${r.date},${r.employee},${r.project},${r.status}\n`;
            });

        const blob = new Blob([csv], { type: "text/csv" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Attendance_${month}.csv`;
        link.click();
    }

    function exportPDF() {
        const month = document.getElementById('monthFilter').value;
        if (!month) return alert("Select a month");

        const script = document.createElement("script");
        script.src = "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";
        script.onload = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(`Attendance Report - ${month}`, 10, 10);

            let y = 20;
            attendanceData
                .filter(r => r.date.startsWith(month))
                .forEach(r => {
                    doc.text(`${r.date} | ${r.employee} | ${r.project} | ${r.status}`, 10, y);
                    y += 8;
                });

            doc.save(`Attendance_${month}.pdf`);
        };
        document.body.appendChild(script);
    }

    updateTable();
</script>

</body>
</html>